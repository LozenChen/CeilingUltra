# CeilingUltra

https://gamebanana.com/mods/485472

本文档的最后更新时间: v1.1.7, 请自行留意这是否是最新版本.

机制的一些细节:

你可以反向天花板 super/hyper, 反向竖直 hyper.

斜冲左右墙可以被墙跳打断竖直 ultra, 但斜冲天花板不能被蹬天花板跳打断天花板 ultra. 这是因为 DashUpdate 中不允许你在地面上进行狼跳, 因此我们也不允许你蹬天花板跳.

竖直向上 hyper 尽管只有 6 帧跳跃长度, 但此时撞到头并不会取消跳跃, 我们有机制保护这一点. 这使得你很容易绕过 1px 的凸出角落 (当然, 鉴于水平速度并不高, 你还需要按住远离墙面的方向).

斜上冲结尾保留竖直速度的机制: 我们以冲刺方向是正斜上为例 (除非你是 超冲 或 360度冲刺), 竖直速度大于 -169.71 则结束后变为 -84.85, 竖直速度小于 -325 则不变, 在两者之间则线性插值.

对于新增加的这些动作 (蹬天花板跳, 天花板 super/hyper, 竖直 hyper), 向下的速度分量并不会获得 LiftBoost.

蹬天花板跳会将 maxFall 设置为 240, 向下竖直 hyper 会将 maxFall 设置为 320.

斜向撞左右墙时, 如果你不是蹲姿 (或者 starFlyHurtbox), 那没什么需要检验的. 但如果是, 则需要检验碰撞箱变为挤压碰撞箱之后, 是否满足地形. 在变化碰撞箱前后, 如果是向左上撞墙 (这里的左上指速度方向而非 DashDir), 则保持碰撞箱左下不变; 向左下撞墙保持碰撞箱左上不变; 右上/下同理. 纵向速度为零的情况视作向上.

斜向撞天花板时, 需要进入蹲姿, 这个过程保持头顶高度不变 (即刚好顶着天花板). 如果原先是挤压碰撞箱, 在尝试进入蹲姿的时候, 水平方向上产生 0, 1, -1 的位移来试图避开固体 (优先顺序取决于速度方向). 如果不能进入蹲姿后成功避开固体, 那么撞天花板 ultra 失败.

天花板 super/hyper 时, 需要解除蹲姿, 这个过程保持头顶高度不变 (即刚好顶着天花板). 如果无法解除蹲姿, 那么不能天花板 super/hyper.

蹬天花板跳时, 会尝试解除蹲姿. 但即使不能解除蹲姿, 也依然能蹬天花板跳.

关于 forceMoveX 究竟何时会起作用, 目前的方案是仅蹬天花板跳会受 forceMoveX 影响 (原版中 super/hyper 也受影响). 但我还没有彻底拿定主意.

冲刺第 5 帧的几种 ultra 的优先级: 地面 ultra > 竖直 ultra > 天花板 ultra. 这保证你在地面靠墙时能顺利做出 reverse hyper.

不同于竖直上冲无法抓跳, 在冲刺并进入挤压态的情况下, 你依然可以抓跳.

我们有特殊的机制保护你仍然能做 delayed ultra: 当一个横向/纵向 ultra 产生时, 玩家会得到一个 OverrideUltra 量, 当你沿 OverrideUltra 所指墙面的法向撞击墙面时, 你的 DashDir 以 OverrideUltra 中记录的方向计算, 并因此能做出一个纵向/横向 ultra. 概况来说就是, (原生的) 横向 ultra 只能转化出纵向 ultra, 纵向 ultra 只能转化出横向 ultra, 转化出的 ultra 无法再次转化. 举例: 斜右下撞地面后, 获得 OverrideUltra(RightWall), 再撞右墙即可做出纵向 ultra. 斜右下撞右墙, 获得 OverrideUltra(Ground), 再撞地即可地面 ultra. 斜右上撞右墙, 获得 OverrideUltra(Ceiling), 再撞天花板即可天花板 ultra. 在所有会重置 DashDir 的值的场合 (e.g. 冲刺开始, ultra 产生), 这些 OverrideUltra 值都会消失, 正如同原版中你无法在这些情形下再次用原先的 DashDir 来获得 ultra.